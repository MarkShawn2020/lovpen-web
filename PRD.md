# 产品需求文档 (PRD) - Lovpen Web 知识库增强

**版本**: v1.0  
**创建日期**: 2025-07-18  
**产品**: Lovpen Web 智能平台  
**负责人**: 产品团队

---

## 1. 产品概述

### 1.1 产品愿景
构建一个智能化的知识管理平台，为用户提供统一的文件存储、组织和检索体验，支持多种文件来源和AI增强功能。

### 1.2 核心价值主张
- **统一知识管理**: 集成多平台文件，统一管理个人知识资产
- **智能组织**: 自动分类和标签化，提升文件检索效率
- **多源整合**: 支持手动上传、AI对话记录、第三方平台同步
- **无缝体验**: 简洁直观的用户界面，降低学习成本

### 1.3 产品定位
面向知识工作者和内容创作者的智能文件管理系统，与现有的AI助手、认证系统深度集成。

---

## 2. 目标用户

### 2.1 用户画像

**主要用户**: 知识工作者
- 年龄: 25-45岁
- 职业: 研究员、内容创作者、产品经理、开发者
- 特点: 需要管理大量文档、注重效率、习惯数字化工作

**次要用户**: 个人用户
- 年龄: 18-35岁
- 需求: 个人文档整理、学习笔记管理
- 特点: 追求简单易用、注重隐私

### 2.2 使用场景

**场景1: 日常文档管理**
- 用户需要上传、整理个人文档
- 希望快速找到历史文件
- 需要按项目或主题分类

**场景2: AI对话记录管理**
- 与AI助手的对话需要持久化保存
- 按时间和主题组织对话记录
- 支持搜索和回顾

**场景3: 知识积累与分享**
- 收集灵感和想法(Memo)
- 整理学习资料(Library)
- 与团队成员分享知识

### 2.3 用户痛点
- 文件分散在不同平台，难以统一管理
- 缺乏有效的文件分类和标签系统
- AI对话记录容易丢失，无法复用
- 搜索功能不够智能，找文件耗时

---

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 知识库文件夹架构
**优先级**: P0 (必须有)

**默认文件夹结构**:
```
知识库/
├── Library/           # 用户手动上传的文件
│   ├── Documents/     # 文档类
│   ├── Images/        # 图片类  
│   ├── Videos/        # 视频类
│   └── Others/        # 其他类型
├── Memo/             # 用户随手记的资料、灵感
│   ├── Ideas/        # 创意想法
│   ├── Notes/        # 学习笔记
│   └── Drafts/       # 草稿
├── Chats/            # 与AI助手的对话记录
│   ├── Claude/       # Claude对话
│   ├── GPT/          # GPT对话
│   └── Others/       # 其他AI对话
├── Imports/          # 第三方平台导入
│   ├── Notion/       # Notion文档
│   ├── Flomo/        # Flomo笔记
│   ├── WeChat/       # 微信内容
│   └── Others/       # 其他平台
└── Shared/           # 共享文件夹
    ├── Public/       # 公开分享
    └── Team/         # 团队共享
```

**功能特性**:
- 支持多级文件夹嵌套
- 自动按文件类型和来源分类
- 支持自定义文件夹创建
- 文件夹权限控制(私有/共享/公开)

#### 3.1.2 文件上传与管理
**优先级**: P0 (必须有)

**上传功能**:
- 拖拽上传、批量上传
- 支持多种文件格式 (文档、图片、视频、音频)
- 文件大小限制和格式验证
- 上传进度显示和断点续传

**文件操作**:
- 重命名、移动、复制、删除
- 文件预览和下载
- 版本管理和历史记录
- 文件标签和描述编辑

#### 3.1.3 智能搜索与检索
**优先级**: P0 (必须有)

**搜索功能**:
- 全文搜索和文件名搜索
- 按文件类型、标签、时间筛选
- 智能推荐和相关文件建议
- 搜索历史和收藏功能

### 3.2 辅助功能

#### 3.2.1 AI增强功能
**优先级**: P1 (应该有)

- 自动文件分类和标签生成
- 文档内容摘要提取
- 图片OCR文字识别
- 语音转文字功能

#### 3.2.2 协作与分享
**优先级**: P1 (应该有)

- 文件链接分享
- 权限控制(查看/编辑/下载)
- 协作编辑和评论
- 分享统计和访问记录

#### 3.2.3 数据同步与备份
**优先级**: P2 (可以有)

- 第三方平台数据同步
- 自动备份和恢复
- 数据导出功能
- 版本控制和冲突解决

---

## 4. 非功能需求

### 4.1 性能要求
- 文件上传速度: ≥10MB/s (100M网络环境)
- 搜索响应时间: ≤500ms
- 页面加载时间: ≤2s
- 并发用户数: ≥1000

### 4.2 安全要求
- 文件加密存储
- 用户权限控制
- 数据传输加密(HTTPS)
- 定期安全审计

### 4.3 可用性要求
- 系统可用性: ≥99.9%
- 故障恢复时间: ≤5分钟
- 数据备份策略: 每日备份
- 灾难恢复能力

### 4.4 兼容性要求
- 浏览器支持: Chrome 90+, Firefox 88+, Safari 14+
- 移动端适配: iOS 14+, Android 10+
- 文件格式支持: 主流文档、图片、视频格式
- API版本兼容性

---

## 5. 用户故事与验收标准

### 5.1 知识库文件夹管理

**用户故事**: 作为用户，我希望有预设的文件夹结构，以便快速组织我的文件。

**验收标准**:
- Given 用户首次访问知识库
- When 用户查看文件列表
- Then 应该看到Library、Memo、Chats等预设文件夹
- And 每个文件夹都有清晰的图标和说明

### 5.2 文件上传与分类

**用户故事**: 作为用户，我希望上传文件时能自动分类到合适的文件夹。

**验收标准**:
- Given 用户选择上传文件
- When 用户拖拽文件到上传区域
- Then 系统根据文件类型自动推荐目标文件夹
- And 用户可以确认或修改目标文件夹
- And 文件上传成功后出现在指定文件夹中

### 5.3 AI对话记录管理

**用户故事**: 作为用户，我希望我与AI的对话记录能自动保存到知识库。

**验收标准**:
- Given 用户与AI助手进行对话
- When 对话结束或达到保存条件
- Then 对话记录自动保存到Chats文件夹
- And 按AI类型(Claude/GPT)分类存储
- And 用户可以搜索和查看历史对话

### 5.4 文件搜索与检索

**用户故事**: 作为用户，我希望能快速找到我需要的文件。

**验收标准**:
- Given 用户在搜索框输入关键词
- When 用户按回车或点击搜索
- Then 系统返回相关文件列表
- And 支持按文件类型、时间等筛选
- And 搜索结果按相关性排序

### 5.5 文件分享与协作

**用户故事**: 作为用户，我希望能方便地分享文件给他人。

**验收标准**:
- Given 用户选择要分享的文件
- When 用户点击分享按钮
- Then 生成分享链接
- And 用户可以设置访问权限(查看/下载)
- And 分享链接有有效期控制

---

## 6. 技术架构

### 6.1 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用      │    │   API Gateway   │    │   后端服务      │
│   Next.js 15    │◄──►│   统一入口      │◄──►│   Files API     │
│   React 19      │    │   认证/授权     │    │   Knowledge API │
│   TypeScript    │    │   限流/监控     │    │   User API      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   存储层        │    │   缓存层        │    │   数据库        │
│   OSS/S3        │    │   Redis         │    │   PostgreSQL    │
│   文件存储      │    │   会话/搜索     │    │   元数据        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 6.2 技术栈选择

**前端技术栈**:
- **框架**: Next.js 15 + React 19 (已选择)
- **UI组件**: shadcn/ui + Tailwind CSS (已有)
- **状态管理**: React Query + Zustand
- **文件上传**: react-dropzone + axios

**后端技术栈**:
- **API**: 现有Files API + Knowledge API (已有)
- **数据库**: PostgreSQL + Drizzle ORM (已配置)
- **文件存储**: OSS/S3兼容存储
- **搜索引擎**: Elasticsearch (全文搜索)

**基础设施**:
- **认证**: Clerk (已集成)
- **监控**: Sentry + PostHog (已配置)
- **安全**: Arcjet (已集成)

### 6.3 数据库设计

**文件表 (files)**:
```sql
CREATE TABLE files (
    id UUID PRIMARY KEY,
    user_id INTEGER NOT NULL,
    filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(100),
    content_type VARCHAR(100),
    source_platform VARCHAR(50),
    parent_id UUID REFERENCES files(id),
    is_directory BOOLEAN DEFAULT FALSE,
    is_public BOOLEAN DEFAULT FALSE,
    tags TEXT[],
    metadata JSONB,
    processing_status VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

**文件夹模板表 (folder_templates)**:
```sql
CREATE TABLE folder_templates (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    path VARCHAR(500) NOT NULL,
    icon VARCHAR(50),
    description TEXT,
    is_system BOOLEAN DEFAULT FALSE,
    sort_order INTEGER DEFAULT 0
);
```

### 6.4 API设计

**核心API端点** (基于现有files_api.json):

```typescript
// 文件管理
POST / files / upload // 单文件上传
POST / files / batch / upload // 批量上传
GET / files // 列出文件
/ GET / files / {file_id} // 获取文件信息
PUT / files / {file_id} // 更新文件
DELETE / files / {file_id} // 删除文件

// 文件夹管理
POST / files / directories // 创建文件夹
GET / files / directories / templates // 获取文件夹模板

// 搜索和过滤
GET / files / search // 搜索文件
GET / files / recent // 最近文件
GET / files / by - type // 按类型筛选

// 分享和权限
POST / files / {file_id} / share // 创建分享链接
GET / files / public / {file_id} // 访问公开文件
```

---

## 7. 实现计划

### 7.1 开发阶段划分

#### 阶段1: 基础架构完善 (1-2周)
**目标**: 完善现有文件管理功能

**任务**:
- [ ] 优化KnowledgeBase组件的文件夹结构显示
- [ ] 实现默认文件夹模板系统
- [ ] 完善文件上传与backend API的对齐
- [ ] 添加文件操作功能(重命名、移动、删除)

**验收标准**:
- 用户可以看到预设的Library/Memo/Chats文件夹
- 文件上传功能正常工作
- 基本的文件管理操作可用

#### 阶段2: 智能分类与搜索 (2-3周)
**目标**: 增强文件组织和检索能力

**任务**:
- [ ] 实现智能文件分类逻辑
- [ ] 优化搜索功能和筛选器
- [ ] 添加文件标签和元数据管理
- [ ] 实现AI对话记录自动保存

**验收标准**:
- 文件能自动分类到合适文件夹
- 搜索响应时间<500ms
- AI对话记录正确保存到Chats文件夹

#### 阶段3: 协作与分享 (2-3周)
**目标**: 支持文件分享和协作功能

**任务**:
- [ ] 实现文件分享链接生成
- [ ] 添加权限控制系统
- [ ] 开发公开文件访问功能
- [ ] 实现文件版本管理

**验收标准**:
- 用户可以生成分享链接
- 权限控制正常工作
- 公开文件可以无需登录访问

#### 阶段4: AI增强功能 (3-4周)
**目标**: 集成AI能力提升用户体验

**任务**:
- [ ] 实现文档内容摘要提取
- [ ] 添加图片OCR识别
- [ ] 开发智能标签推荐
- [ ] 实现相关文件推荐

**验收标准**:
- AI功能正常工作且响应速度合理
- 用户反馈积极，使用频率高

### 7.2 风险评估

**技术风险**:
- **风险**: 文件存储成本过高
- **缓解**: 实现文件压缩和分层存储

**产品风险**:
- **风险**: 用户接受度不高
- **缓解**: 进行用户测试和反馈收集

**时间风险**:
- **风险**: 开发进度延迟
- **缓解**: 采用MVP方式，分阶段发布

### 7.3 成功指标

**技术指标**:
- 文件上传成功率 ≥99%
- 搜索响应时间 ≤500ms
- 系统可用性 ≥99.9%

**业务指标**:
- 用户文件上传量增长 ≥50%
- 搜索使用频率增长 ≥30%
- 用户留存率提升 ≥20%

**用户体验指标**:
- 用户满意度 ≥4.5/5
- 功能使用率 ≥70%
- 支持工单减少 ≥30%

---

## 8. 附录

### 8.1 现有技术栈
- **前端**: Next.js 15, React 19, TypeScript, Tailwind CSS
- **后端**: FastAPI, PostgreSQL, Drizzle ORM
- **认证**: Clerk (OAuth2)
- **监控**: Sentry, PostHog
- **安全**: Arcjet

### 8.2 相关文档
- [Knowledge API文档](./backend-apis/knowledge_api.json)
- [Files API文档](./backend-apis/files_api.json)
- [项目架构说明](./CLAUDE.md)
- [开发指南](./README.md)

### 8.3 更新记录
- **v1.0** (2025-07-18): 初始版本，基于现有项目分析

---

*本PRD文档将根据开发进展和用户反馈持续更新。*
